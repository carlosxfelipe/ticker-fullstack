{% extends 'base.html' %}

{% block title %}Minha Carteira{% endblock %}

{% block content %}
  <h1>Minha Carteira</h1>  
  <form method="post" style="margin-bottom:2rem;">
    {% csrf_token %}
    <input type="hidden" name="id" value="{{ ativo_edit.id|default:'' }}">
    <label for="ticker">Ticker</label>
    <input type="text" id="ticker" name="ticker" value="{{ ativo_edit.ticker|default:'' }}" required>
    <label for="quantity">Quantidade</label>
    <input type="number" id="quantity" name="quantity" value="{{ ativo_edit.quantity|default:'' }}" required>
    <label for="average_price">Preço Médio</label>
    <input type="number" step="0.01" id="average_price" name="average_price" value="{{ ativo_edit.average_price|default:'' }}" required>
    <button type="submit" class="btn">{% if ativo_edit %}Salvar{% else %}Adicionar{% endif %}</button>
    {% if ativo_edit %}
      <a href="{% url 'wallet:home' %}" class="btn btn-secondary">Cancelar</a>
    {% endif %}
  </form>

  <table>
    <thead>
      <tr>
        <th>Ticker</th>
        <th>Quantidade</th>
        <th>Preço Médio</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for ativo in ativos %}
      <tr>
        <td>{{ ativo.ticker }}</td>
        <td>{{ ativo.quantity }}</td>
        <td>{{ ativo.average_price }}</td>
        <td>
          <div style="display: flex; gap: 0.5rem;">
            <form action="?edit={{ ativo.id }}" method="get" style="margin: 0;">
              <button type="submit" class="btn btn-sm">Editar</button>
            </form>
            <form action="?delete={{ ativo.id }}" method="post" style="margin: 0;">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-danger">Remover</button>
            </form>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4">Nenhum ativo cadastrado.</td></tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
